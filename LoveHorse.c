#include <stdint.h>
#include <nds.h>

typedef int8_t   i8;
typedef uint8_t  u8;
typedef int16_t  i16;
typedef uint16_t u16;
typedef int32_t  i32;
typedef uint32_t u32;
typedef int64_t  i64;
typedef uint64_t u64;
typedef float    r32;
typedef double   r64;
typedef i32      b32;

//#define MODE_FB0 0x00020000
//#define VRAM_ENABLE 0x80
//#define VRAM_A_LCD 0
//#define VRAM_A 0x06800000

int _start(void)
{
    u32 IoSpace = 0x04000000;
    u16 Color = 0;

    // POWERCNT
    *(u32 *)(IoSpace + 0x304) = 0x00000003; // Both screens on

    //Use VRAM_A as framebuffer
    *(u32 *)(IoSpace) = MODE_FB0; // DISPCNT

    // VRAM bank A enabled in LCD mode
    *(u32 *)(IoSpace + 0x240) = (VRAM_ENABLE | VRAM_A_LCD); // VRAMCNT_A

    // Full brightness
    *(u32 *)(IoSpace + 0x06C) = 0x00000000; // May not need this because not fifa

    while (1)
    {
        u32 PixelCount = 256 * 192;
        u16 *VramA = (u16 *)VRAM_A;
        Color += 0x31;
        while (--PixelCount)
        {
            *(u16*)(VramA++) = Color;
        }
    }

	return IoSpace;
}

